name: CI

on:
  push:
  pull_request:

jobs:
  bun:
    name: Bun
    runs-on: ubuntu-latest
    concurrency: ci-nodejs-${{ github.ref }}

    steps:
      - name: Checkout Repository
        uses: actions/checkout@v4

      - name: Install Bun
        uses: oven-sh/setup-bun@v2

      - name: Install Packages
        run: bun install --frozen-lockfile

      - name: Build Client
        working-directory: ./client
        run: bun build:client

      - name: Build Server
        working-directory: ./server
        run: bunx --bun tsc -v --noEmit

      - name: Build Tests
        working-directory: ./tests
        run: bunx --bun tsc -v --noEmit

      - name: Validate Definitions
        working-directory: ./tests
        run: cp ../server/config.example.json ../server/config.json && bun validateDefinitions

      - name: Validate SVGs
        working-directory: ./tests
        run: bun validateSvgs
        if: success() || failure()

      - name: Lint
        run: bun lint:check
